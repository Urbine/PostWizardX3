========================
Configuration Management
========================

Configuration files in the ``core`` package are located under the ``config`` folder. Here
is where the user is expected to input all variables unique to the WordPress sites that this project will help you manage
alongside secrets that allow bots and tasks for information exchange with your services.

I used the ``.ini`` configuration files since the format has been around for many years.
If you have been using software packages for a long time now, it may be the case that ``ini`` files are no surprise to you.

If you haven't, don't worry. Let's go over the most important files that compose the core of ``webmaster-seo-tools``:

1. client_info.ini
==================

Secrets are stored locally in this configuration file to avoid sensitive data leaks.
I do not include a copy of my ``client_info.ini`` for obvious reasons.
However, here is a template that can help you get started:

.. code-block:: ini

    [WP_Admin]
    user = <admin or another username>
    app_password = <the app password you generated on WordPress>
    author_admin = 1
    hostname = <mysite.xyz>
    api_base_url = https://mysite.xyz/wp-json/wp/v2
    full_base_url = https://mysite.xyz
    default_status = draft
    wp_cache_file = wp_cache_config.json
    wp_posts_file = wp_posts.json
    wp_photos_file = wp_photos.json
    # Only the directory name
    logging_dirname = logs

    [MongerCash]
    username = <mcash_username>
    password = <mcash_password>

    [Yandex]
    client_id =
    client_secret =

    [x_api]
    uri_callback =
    x_username =
    x_passw =
    x_email =
    api_key =
    api_secret =
    client_id =
    client_secret =
    access_token = <added automatically after app authorization>
    refresh_token = <added automatically after app authorization>

    [telegram_botfather]
    telegram_group_channel_id = @<your-group-or-channel>
    bot_token =

    [brave_search_api]
    api_key_search =

    [google_custom_search]
    api_key =
    <Generated one with image search, no safesearch filtering>
    <Both cse ids can be equal if you use a custom search engine that supports image search>
    search_engine_id_img =
    search_engine_id_web =

Just fill in the configuration options once you have the information required.

.. caution::
  As you can observe, unused options are not assigned and this is okay for now.
  You can leave the blank spaces if that functionality is not used and as long as
  behaviour tied to those options has been disabled in the ``workflows_config.ini`` file.

2. tasks_config.ini
===================

Tasks have a couple of constants that are already included in the package distribution and repository.
You can find the file in ``core.config``.

It looks similar to this template:

.. code-block:: ini

   [dump_create_config]
   mcash_dump_url = https://mongercash.com/internal.php?page=adtools&category=3&typeid=23&view=dump
   mcash_set_url = https://mongercash.com/internal.php?page=adtools&category=3&typeid=4

   [adult_next]
   abjav_campaig_id =

   [tubecorp_feeds]
   source_id =

   [fhouse_api]
   # Found in the dump data like "utm_campaign=xx.xxx"
   fhouse_camp_utm =

3. assets.ini
=============

``assets.ini`` exists because some partners offer banners or images that are supposed to help
webmasters promote their products, subscriptions or perks by sharing a banner with a tracking link.
Tracking links are part of affiliate marketing revenue models.

.. note::
   If you work with the MongerCash affiliate program, the database schema generated by
   modules in the ``tasks`` package contain tracking links by default.
   It is recommended that you add assets to make the most out of this functionality.

This configuration file can have virtually any structure but it must abide by a single rule:
**Sections must contain one word that defines the partner offer you are targeting or its full name**

Section is another word for the heading of options that are characteristic of ``.ini`` files.
For example, ``[WP_Admin]`` in the ``client_info.ini`` template above.

.. tip::
   The word that defines or helps identify your partner offering is commonly referred to as "hint"
   throughout the entire docs.
   This word must be significant, which means that it is not a word that is repeated in your offerings.

   For example, if you have two partners ``foo patrol`` and ``bar patrol``, the significant hint will be
   ``foo`` or ``bar`` and not ``patrol``.

   .. code-block:: ini

      # with hint only
      [banner_foo_xyz] # if you want to add the type of asset like "banner", it's okay.
      this_one_can_be_whatever = <url_to_your_banner_or_image>

      # or you can use the full name as well
      [bar_patrol] # "banner" or "image" is not necessary, though.
      also_here = <url_to_your_banner_or_image>

This file will be processed by the ``workflows.content_select`` bot with a simple
parsing algorithm that will match your common assets (like banners or images) to your partner offers during runtime.

.. warning::
   As of now, only ``workflows.content_select`` supports assets from this file.
   This bot has not been tested in scenarios where assets are not provided and ignoring them
   could potentially either crash the application, not allow it to start its flow properly or
   malfunction during runtime. This will be addressed in future releases.

   If you do not plan to use ``workflows.content_select``, ignore this warning.

4. workflows_config.ini
=======================

``workflows_config.ini`` is the key to understanding the power of all workflow bots:

1. ``workflows.content_select``

2. ``workflows.gallery_select``

3. ``workflows.embed_assist``

The only exception in this list is ``workflows.update_mcash_chain`` since it coordinates the
tasks and does not receive behavioural tweaks, only uses the constants present in ``tasks_config.ini``.

Here is a template of this file to aid your understanding:

.. code:: ini

    [general_config]
    pic_format = .webp
    imagick_enabled = False
    conversion_quality = 80
    fallback_pic_format = .jpg
    website_name = <YOUR_SITE_DISPLAY_NAME>
    domain_tld = <TLD>
    wp_json_posts = wp_posts.json
    wp_cache_config = wp_cache_config.json
    # Only the directory name in project root
    logging_dirname = logs
    # Tweak this option if you want to remove image attributes
    # This is useful to de-optimise images for SEO
    img_attrs = False

    [content_select]
    pic_format = .jpg
    # Alternative queries:
    # SELECT * FROM videos WHERE date>='2024' OR date>='2023'
    # SELECT * FROM videos WHERE date>='2022' AND duration!='trailer'
    sql_query = SELECT * FROM videos WHERE duration!='trailer' ORDER BY date DESC
    # Based on the file that integrations generate
    # Usually partner-dbContentHint-date
    db_content_hint = vids
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    assets_conf = assets.ini
    # Comma separated partners
    partners= <partners>

    [gallery_select]
    # The format and files can include or exclude the extension as the functions in this
    # project are equipped to deal with that.
    wp_json_photos = wp_photos.json
    db_content_hint = photos
    sql_query = SELECT * FROM sets
    reverse_slug = True
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    # Comma separated partners
    partners= <partners>

    [embed_assist]
    sql_query = SELECT * FROM embeds ORDER BY date DESC
    db_content_hint = dump
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    # Comma separated partners
    partners= <partners>

.. note::
   If you need API secrets, keys or client credentials, go to the developers website available for the integration you intend to use.

   For example:
   `X Developer Platform <https://docs.x.com/home>`_ or `Telegram APIs <https://core.telegram.org/api>`_

.. tip::
   It is a good idea to keep certain values that I have populated for you in templates, however,
   you can change them with based on the comments or your own understanding of the tools.

   The distribution and repository include a preconfigured copy of non-sensitive files,
   so that you can adapt it to your needs.

   Also, you can use the provided setup script to generate these files for you:

   .. code:: console

      $ python3 -m setup.config_create

.. caution::
   Configuration files must be added and modified accordingly before executing the tools.
   As mentioned above, with the exception of ``assets.ini`` that is only required by ``workflows.content_select``,
   other all other files are required by the tools in the ``workflows``, ``tasks`` and ``core`` packages.
   Ignoring them will inevitably result in undesirable behaviour or tracebacks (crashes).

.. seealso::
   If you want to understand more about the ``general_config`` section and how it relates
   to image formats, head over to `Image Conversion <tricks_additional.html#image-conversion>`_
