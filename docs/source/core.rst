core package
============

``core`` contains reusable implementations and configuration files that control:

1. Authentication and project-wide secrets.

2. Task constants.

3. Asset and behaviour variables for workflows.

4. Custom exceptions.

5. Helper utilities.

The main ideas behind the concept of configuration manager that I adopted is modularity,
adaptability and security. All configuration files are parsed and delivered to other modules
by using special factory functions with immutable objects that can't be modified during runtime.

Advantages to this approach are the ability to modify values without messing with the code to
personalize the experience while using the tools. Data gets validated within the application to ensure
that behaviour is not unexpected and exceptions containing helpful messages contribute to effective troubleshooting.

Alright, let's dive into the main topics that you need to understand and use these modules.

Configuration Management
------------------------

Configuration files in the ``core`` package are located under the ``config`` folder. Here
is where the user is expected to input all variables unique to the WordPress sites that this project will help you manage
alongside secrets that allow bots and tasks for information exchange with your services.

I used the ``.ini`` configuration files since the format has been around for many years.
If you have been using software packages for a long time now, it may be the case that ``ini`` files are no surprise to you.

If you haven't, don't worry. Let's go over the most important files that compose the core of ``webmaster-seo-tools``:

1. client_info.ini
###################

Secrets are stored locally in this configuration file to avoid sensitive data leaks.
I do not include a copy of my ``client_info.ini`` for obvious reasons.
However, here is a template that can help you get started:

.. code-block:: ini

    [WP_Admin]
    user = <admin or another username>
    app_password = <the app password you generated on WordPress>
    author_admin = 1
    hostname = <mysite.xyz>
    api_base_url = https://mysite.xyz/wp-json/wp/v2
    full_base_url = https://mysite.xyz
    default_status = draft
    wp_cache_file = wp_cache_config.json
    wp_posts_file = wp_posts.json
    wp_photos_file = wp_photos.json

    [MongerCash]
    username = <mcash_username>
    password = <mcash_password>

    [Yandex]
    client_id =
    client_secret =

    [x_api]
    uri_callback =
    x_username =
    x_passw =
    x_email =
    api_key =
    api_secret =
    client_id =
    client_secret =
    access_token = <added automatically after app authorization>
    refresh_token = <added automatically after app authorization>

    [telegram_botfather]
    telegram_group_channel_id = @<your-group-or-channel>
    bot_token =

Just fill in the configuration options once you have the information required.

.. caution::
  As you can observe, unused options are not assigned and this is okay for now.
  You can leave the blank spaces if that functionality is not used and as long as
  behaviour tied to those options has been disabled in the ``workflows_config.ini`` file.

2. tasks_config.ini
####################

Tasks have a couple of constants that are already included in the package distribution and repository.
You can find the file in ``core.config``.

3. assets.ini
##############

``assets.ini`` exists because some partners offer banners or images that are supposed to help
webmasters promote their products, subscriptions or perks by sharing a banner with a tracking link.
Tracking links are part of affiliate marketing revenue models.

.. note::
   If you work with the MongerCash affiliate program, the database schema generated by
   modules in the ``tasks`` package contain tracking links by default.
   It is recommended that you add assets to make the most out of this functionality.

This configuration file can have virtually any structure but it must abide by a single rule:
**Sections must contain one word that defines the partner offer you are targeting or its full name**

Section is another word for the heading of options that are characteristic of ``.ini`` files.
For example, ``[WP_Admin]`` in the ``client_info.ini`` template above.

.. tip::
   The word that defines or helps identify your partner offering is commonly referred to as "hint"
   throughout the entire docs.
   This word must be significant, which means that it is not a word that is repeated in your offerings.

   For example, if you have two partners ``foo patrol`` and ``bar patrol``, the significant hint will be
   ``foo`` or ``bar`` and not ``patrol``.

   .. code-block:: ini

      # with hint only
      [banner_foo_xyz] # if you want to add the type of asset like "banner", it's okay.
      this_one_can_be_whatever = <url_to_your_banner_or_image>

      # or you can use the full name as well
      [bar_patrol] # "banner" or "image" is not necessary, though.
      also_here = <url_to_your_banner_or_image>

This file will be processed by the ``workflows.content_select`` bot with a simple
parsing algorithm that will match your common assets (like banners or images) to your partner offers during runtime.

.. warning::
   As of now, only ``workflows.content_select`` supports assets from this file.
   This bot has not been tested in scenarios where assets are not provided and ignoring them
   could potentially either crash the application, not allow it to start its flow properly or
   malfuntion during runtime. This will be addressed in future releases.

   If you do not plan to use ``workflows.content_select``, ignore this warning.

4. workflows_config.ini
#######################

``workflows_config.ini`` is the key to understanding the power of all workflow bots:

1. ``workflows.content_select``

2. ``workflows.gallery_select``

3. ``workflows.embed_assist``

The only exception in this list is ``workflows.update_mcash_chain`` since it coordinates the
tasks and does not receive behavioural tweaks, only uses the constants present in ``tasks_config.ini``.

Here is a template of this file to aid your understanding:

.. code:: ini

    [general_config]
    # Consider whether or not ImageMagick is enabled before using next-gen image formats.
    pic_format = .webp
    # Make sure to capitalise "True" and "False" to avoid IncorrectConfiguration exceptions.
    imagick_enabled = False
    conversion_quality = 80
    # Fallback image format if ImageMagick is not enabled or not found.
    # This is usually the source format of the thumbnails or
    # images you download and plan to utilise on WP.
    fallback_pic_format = .jpg
    website_name = <YOUR_SITE_DISPLAY_NAME>
    domain_tld = <TLD>
    wp_json_posts = wp_posts.json
    wp_cache_config = wp_cache_config.json

    [content_select]
    pic_format = .jpg
    # Alternative queries:
    # SELECT * FROM videos WHERE date>='2024' OR date>='2023'
    # SELECT * FROM videos WHERE date>='2022' AND duration!='trailer'
    sql_query = SELECT * FROM videos WHERE duration!='trailer' ORDER BY date DESC
    # Based on the file that integrations generate
    # Usually partner-dbContentHint-date
    db_content_hint = vids
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    assets_conf = assets.ini
    # Comma separated partners
    partners= <partners>

    [gallery_select]
    # The format and files can include or exclude the extension as the functions in this
    # project are equipped to deal with that.
    wp_json_photos = wp_photos.json
    db_content_hint = photos
    sql_query = SELECT * FROM sets
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    # Comma separated partners
    partners= <partners>

    [embed_assist]
    sql_query = SELECT * FROM embeds ORDER BY date DESC
    db_content_hint = dump
    x_posting_auto = False
    x_posting_enabled = False
    telegram_posting_auto = False
    telegram_posting_enabled = False
    # Comma separated partners
    partners= <partners>

.. note::
   If you need API secrets, keys or client credentials, go to the developers website available for the integration you intend to use.

   For example:
   `X Developer Platform <https://docs.x.com/home>`_ or `Telegram APIs <https://core.telegram.org/api>`_

.. tip::
   It is a good idea to keep certain values that I have populated for you in templates, however,
   you can change them with based on the comments or your own understanding of the tools.

   The distribution and repository include a preconfigured copy of non-sensitive files,
   so that you can adapt it to your needs.

   Also, you can use the provided setup script to generate these files for you:

   .. code:: console

      $ python3 -m setup.config_create

.. caution::
   Configuration files must be added and modified accordingly before executing the tools.
   As mentioned above, with the exception of ``assets.ini`` that is only required by ``workflows.content_select``,
   other all other files are required by the tools in the ``workflows``, ``tasks`` and ``core`` packages.
   Ignoring them will inevitably result in undesirable behaviour or tracebacks (crashes).








Submodules
----------

core.config\_mgr module
-----------------------

.. automodule:: core.config_mgr
   :members:
   :undoc-members:
   :show-inheritance:

core.custom\_exceptions module
------------------------------

.. automodule:: core.custom_exceptions
   :members:
   :undoc-members:
   :show-inheritance:

core.helpers module
-------------------

.. automodule:: core.helpers
   :members:
   :undoc-members:
   :show-inheritance:

Module contents
---------------

.. automodule:: core
   :members:
   :undoc-members:
   :show-inheritance:
